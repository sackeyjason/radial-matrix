{"version":3,"sources":["fps.js","mode_selector.js","input.js","game_data.js","../node_modules/shuffle-array/index.js","game.js","geometry.js","../node_modules/browser-split/index.js","../node_modules/indexof/index.js","../node_modules/class-list/index.js","../node_modules/hyperscript/index.js","app.js"],"names":["fpsUpdateDelay","updateFps","t","Math","round","renderFps","ctx","fps","fillStyle","fillRect","font","fillText","ModeSelector","select","events","mode","init","addEventListener","value","push","input","keyMap","el","event","keyCode","querySelectorAll","forEach","button","target","dataset","seeds","name","colour","pieces","i","shape","centre","z","s","o","l","j","I_WALLKICK_DATA","OTHER_WALLKICK_DATA","DEFAULT_OPTIONS","screenWidth","screenHeight","gridWidth","gridHeight","voidRadius","crustThickness","queue","getWrapX","GRID_WIDTH","wrapX","x","getPieceGridCoords","piece","grid","length","coords","line","y","block","map","angle","xTranslation","yTranslation","_x","_y","doesCollide","collides","spawn","next","getNext","shift","type","falling","fallNext","pieceTypes","Object","keys","console","log","removeLines","lines","reverse","splice","newEmptyRow","Array","fill","unshift","calculatePoints","etc","start","score","level","addScore","points","awardPoints","linesCleared","tryRotate","sequence","rotatedFrom","d","shiftedPiece","getColour","opts","archetype","getCircleToGrid","GRID_HEIGHT","VOID_RADIUS","ACTIVE_RADIUS","radius","floor","PI","halfPi","getAngle","atan","grid2","SCREEN_WIDTH","SCREEN_HEIGHT","CRUST_THICKNESS","SCREEN_CENTRE","circleRadius","circle","bottom","w","modeSelector","clearing","mainMenu","clearGrid","row","gridLookup","getGridCoords","renderGrid","pixelHeight","hue","dotX","xCentre","yCentre","dx","dy","sqrt","gridX","gridY","fuzz","random","shock","hasShape","clearingRow","hue2","getClickHandler","e","timestamp","startedAt","rect","getBoundingClientRect","clientX","left","clientY","top","scale","width","lockPieceIn","dim","newGame","menuEl","document","querySelector","parentElement","removeChild","startTime","shockDecay","processEvent","rotation","speed","fallingSpeed","update","max","slice","pieceRotated","rotateAttempt","at","completeLines","undefined","find","pointsAwarded","lastPiece","showMainMenu","lastScore","message","menuScreen","appendChild","render","window","performance","now","Date","last","step","min","requestAnimationFrame","view","setAttribute","getContext"],"mappings":"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","file":"app.25afab3d.js","sourceRoot":"..\\src","sourcesContent":["let fpsUpdateDelay = 0;\r\n\r\nexport function updateFps(t) {\r\n  fpsUpdateDelay += t;\r\n  if (fpsUpdateDelay > 1000) {\r\n    fpsUpdateDelay = 0;\r\n    return Math.round(1 / (t / 1000));\r\n  }\r\n}\r\n\r\n\r\nexport function renderFps(ctx, fps) {\r\n  // Draw number to the screen\r\n  ctx.fillStyle = \"#333\";\r\n  ctx.fillRect(0, 0, 80, 32);\r\n  ctx.font = \"14px Arial\";\r\n  ctx.fillStyle = \"#CCC\";\r\n  ctx.fillText(\"FPS: \" + fps, 10, 20);\r\n}\r\n","export default function ModeSelector(select, events) {\r\n  this.mode = \"normal\";\r\n  this.init = () => {\r\n    select.addEventListener(\"change\", () => {\r\n      this.mode = select.value;\r\n      if (select.value === 'nuts') {\r\n        events.push('go nuts');\r\n      }\r\n    })\r\n    select.value = 'normal';\r\n    \r\n  }\r\n}\r\n","const keyMap = {\r\n  37: \"left\",\r\n  38: \"rotateR\",\r\n  39: \"right\",\r\n  40: \"down\",\r\n\r\n  90: \"rotateL\",\r\n  88: \"rotateR\",\r\n  32: \"hardDrop\",\r\n\r\n  13: \"enter\",\r\n};\r\n\r\nconst input = {\r\n  init: (el, events) => {\r\n    el.addEventListener(\"keydown\", (event) => {\r\n      // console.log('event: ', event);\r\n      const value = keyMap[event.keyCode];\r\n      if (value) events.push([\"input\", value]);\r\n    });\r\n    el.querySelectorAll(\"button\").forEach((button) => {\r\n      button.addEventListener(\"touchstart\", (event) => {\r\n        events.push([\"input\", event.target.dataset.input]);\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nexport default input;\r\n","const seeds = [\r\n  {\r\n    name: \"swamp\",\r\n    colour: \"#7d8c3a\",\r\n  },\r\n  // {\r\n  //   name: \"castle\",\r\n  //   colour: \"#5742b7\"\r\n  // }\r\n];\r\n\r\nconst pieces = {\r\n  i: {\r\n    shape: [[1, 1, 1, 1]],\r\n    centre: [1.5, 0.5],\r\n    colour: \"#7FDBFF\",\r\n  },\r\n  t: {\r\n    shape: [\r\n      [0, 1],\r\n      [1, 1, 1],\r\n    ],\r\n    centre: [1, 1],\r\n    colour: \"#7d8c3a\",\r\n  },\r\n  z: {\r\n    shape: [\r\n      [1, 1],\r\n      [0, 1, 1],\r\n    ],\r\n    centre: [1, 1],\r\n    colour: \"#FF4136\"\r\n  },\r\n  s: {\r\n    shape: [\r\n      [0, 1, 1],\r\n      [1, 1],\r\n    ],\r\n    centre: [1, 1],\r\n    colour: \"#2ECC40\"\r\n  },\r\n  o: {\r\n    shape: [\r\n      [1, 1],\r\n      [1, 1],\r\n    ],\r\n    centre: [0.5, 0.5],\r\n    colour: \"#FFDC00\"\r\n  },\r\n  l: {\r\n    shape: [\r\n      [0, 0, 1],\r\n      [1, 1, 1],\r\n    ],\r\n    centre: [1, 1],\r\n    colour: \"#0074D9\"\r\n  },\r\n  j: {\r\n    shape: [\r\n      [1, 0, 0],\r\n      [1, 1, 1],\r\n    ],\r\n    centre: [1, 1],\r\n    colour: \"#FF851B\"\r\n  },\r\n};\r\n\r\n// Data source: https://tetris.fandom.com/wiki/SRS\r\n// \"Super Rotation System\"\r\n\r\nconst I_WALLKICK_DATA = {\r\n  \"01\": [\r\n    [0, 0],\r\n    [-2, 0],\r\n    [1, 0],\r\n    [-2, -1],\r\n    [1, 2],\r\n  ],\r\n  10: [\r\n    [0, 0],\r\n    [2, 0],\r\n    [-1, 0],\r\n    [2, 1],\r\n    [-1, -2],\r\n  ],\r\n  12: [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [2, 0],\r\n    [-1, 2],\r\n    [2, -1],\r\n  ],\r\n  21: [\r\n    [0, 0],\r\n    [1, 0],\r\n    [-2, 0],\r\n    [1, -2],\r\n    [-2, 1],\r\n  ],\r\n  23: [\r\n    [0, 0],\r\n    [2, 0],\r\n    [-1, 0],\r\n    [2, 1],\r\n    [-1, -2],\r\n  ],\r\n  32: [\r\n    [0, 0],\r\n    [-2, 0],\r\n    [1, 0],\r\n    [-2, -1],\r\n    [1, 2],\r\n  ],\r\n  30: [\r\n    [0, 0],\r\n    [1, 0],\r\n    [-2, 0],\r\n    [1, -2],\r\n    [-2, 1],\r\n  ],\r\n  \"03\": [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [2, 0],\r\n    [-1, 2],\r\n    [2, -1],\r\n  ],\r\n};\r\n\r\nconst OTHER_WALLKICK_DATA = {\r\n  \"01\": [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [-1, 1],\r\n    [0, -2],\r\n    [-1, -2],\r\n  ],\r\n  10: [\r\n    [0, 0],\r\n    [1, 0],\r\n    [1, -1],\r\n    [0, 2],\r\n    [1, 2],\r\n  ],\r\n  12: [\r\n    [0, 0],\r\n    [1, 0],\r\n    [1, -1],\r\n    [0, 2],\r\n    [1, 2],\r\n  ],\r\n  21: [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [-1, 1],\r\n    [0, -2],\r\n    [-1, -2],\r\n  ],\r\n  23: [\r\n    [0, 0],\r\n    [1, 0],\r\n    [1, 1],\r\n    [0, -2],\r\n    [1, -2],\r\n  ],\r\n  32: [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [-1, -1],\r\n    [0, 2],\r\n    [-1, 2],\r\n  ],\r\n  30: [\r\n    [0, 0],\r\n    [-1, 0],\r\n    [-1, -1],\r\n    [0, 2],\r\n    [-1, 2],\r\n  ],\r\n  \"03\": [\r\n    [0, 0],\r\n    [1, 0],\r\n    [1, 1],\r\n    [0, -2],\r\n    [1, -2],\r\n  ],\r\n};\r\n\r\nexport { pieces, seeds, OTHER_WALLKICK_DATA, I_WALLKICK_DATA };\r\n","'use strict';\n\n/**\n * Randomize the order of the elements in a given array.\n * @param {Array} arr - The given array.\n * @param {Object} [options] - Optional configuration options.\n * @param {Boolean} [options.copy] - Sets if should return a shuffled copy of the given array. By default it's a falsy value.\n * @param {Function} [options.rng] - Specifies a custom random number generator.\n * @returns {Array}\n */\nfunction shuffle(arr, options) {\n\n  if (!Array.isArray(arr)) {\n    throw new Error('shuffle expect an array as parameter.');\n  }\n\n  options = options || {};\n\n  var collection = arr,\n      len = arr.length,\n      rng = options.rng || Math.random,\n      random,\n      temp;\n\n  if (options.copy === true) {\n    collection = arr.slice();\n  }\n\n  while (len) {\n    random = Math.floor(rng() * len);\n    len -= 1;\n    temp = collection[len];\n    collection[len] = collection[random];\n    collection[random] = temp;\n  }\n\n  return collection;\n};\n\n/**\n * Pick one or more random elements from the given array.\n * @param {Array} arr - The given array.\n * @param {Object} [options] - Optional configuration options.\n * @param {Number} [options.picks] - Specifies how many random elements you want to pick. By default it picks 1.\n * @param {Function} [options.rng] - Specifies a custom random number generator.\n * @returns {Object}\n */\nshuffle.pick = function(arr, options) {\n\n  if (!Array.isArray(arr)) {\n    throw new Error('shuffle.pick() expect an array as parameter.');\n  }\n\n  options = options || {};\n\n  var rng = options.rng || Math.random,\n      picks = options.picks || 1;\n\n  if (typeof picks === 'number' && picks !== 1) {\n    var len = arr.length,\n        collection = arr.slice(),\n        random = [],\n        index;\n\n    while (picks && len) {\n      index = Math.floor(rng() * len);\n      random.push(collection[index]);\n      collection.splice(index, 1);\n      len -= 1;\n      picks -= 1;\n    }\n\n    return random;\n  }\n\n  return arr[Math.floor(rng() * arr.length)];\n};\n\n/**\n * Expose\n */\nmodule.exports = shuffle;\n","import {\r\n  pieces,\r\n  seeds,\r\n  OTHER_WALLKICK_DATA,\r\n  I_WALLKICK_DATA,\r\n} from \"./game_data\";\r\nimport shuffle from \"shuffle-array\";\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  screenWidth: 640,\r\n  screenHeight: 480,\r\n  gridWidth: 32,\r\n  gridHeight: 20,\r\n  voidRadius: 16,\r\n  crustThickness: 16,\r\n};\r\n\r\nconst queue = [];\r\n\r\nexport function getWrapX(GRID_WIDTH) {\r\n  return function wrapX(x) {\r\n    if (x >= GRID_WIDTH) return x % GRID_WIDTH;\r\n    if (x < 0) return wrapX(GRID_WIDTH + x);\r\n    return x;\r\n  };\r\n}\r\n\r\nexport function getPieceGridCoords(piece, grid) {\r\n  // console.log('grid: ', grid[0]);\r\n  const wrapX = getWrapX(grid[0].length);\r\n  let coords = [];\r\n\r\n  piece.shape.forEach((line, y) => {\r\n    line.forEach((block, x) => {\r\n      if (block) {\r\n        coords.push([x + piece.x, y + piece.y]);\r\n      }\r\n    });\r\n  });\r\n\r\n  coords = coords.map(([x, y]) => {\r\n    if (piece.angle === 0) return [wrapX(x), y];\r\n    let xTranslation = piece.x + piece.centre[0];\r\n    let yTranslation = piece.y + piece.centre[1];\r\n    let _x = x - xTranslation;\r\n    let _y = y - yTranslation;\r\n\r\n    if (piece.angle === 1) {\r\n      [_x, _y] = [_y, -_x];\r\n    } else if (piece.angle === 2) {\r\n      [_x, _y] = [-_x, -_y];\r\n    } else if (piece.angle === 3) {\r\n      [_x, _y] = [-_y, _x];\r\n    }\r\n\r\n    _x += xTranslation;\r\n    _y += yTranslation;\r\n    return [wrapX(_x), _y];\r\n  });\r\n\r\n  return coords;\r\n}\r\n\r\n// use getPieceGridCoords\r\nexport function doesCollide(piece, grid) {\r\n  const coords = getPieceGridCoords(piece, grid);\r\n  let collides;\r\n  coords.forEach(([x, y]) => {\r\n    if (y >= grid.length) collides = true;\r\n    if (grid[y] && grid[y][x]) {\r\n      collides = true;\r\n    }\r\n  });\r\n  return collides;\r\n}\r\n\r\nexport function spawn() {\r\n  const next = getNext();\r\n  queue.shift();\r\n  if (next.type === \"seed\") {\r\n    return {\r\n      x: 14,\r\n      y: 0,\r\n      type: \"seed\",\r\n      angle: 0,\r\n      falling: 0,\r\n      fallNext: 1,\r\n      shape: [[1]],\r\n      centre: [0, 0],\r\n    };\r\n  } else {\r\n    const piece = {\r\n      x: 14,\r\n      y: 0,\r\n      type: next,\r\n      angle: 0,\r\n      falling: 0,\r\n      fallNext: 1,\r\n      shape: pieces[next].shape,\r\n      centre: pieces[next].centre,\r\n    };\r\n    return piece;\r\n  }\r\n}\r\n\r\nexport function getNext() {\r\n  if (queue.length === 0) {\r\n    // Replenish queue\r\n    let pieceTypes = Object.keys(pieces);\r\n    // pieceTypes.push({ type: 'seed'}, { type: 'seed'}, { type: 'seed'});\r\n    shuffle(pieceTypes);\r\n    console.log(pieceTypes)\r\n    queue.push(...pieceTypes);\r\n  }\r\n  return queue[0];\r\n}\r\n\r\nexport function removeLines(lines, grid) {\r\n  lines.reverse().forEach((y) => {\r\n    grid.splice(y, 1);\r\n  });\r\n  for (let i = 0; i < lines.length; i++) {\r\n    let newEmptyRow = new Array(32).fill(0);\r\n    grid.unshift(newEmptyRow);\r\n  }\r\n}\r\n\r\nexport function calculatePoints(lines, etc) {\r\n  if (lines === 1) {\r\n    return 100;\r\n  } else if (lines === 2) {\r\n    return 300;\r\n  } else if (lines === 3) {\r\n    return 500;\r\n  } else {\r\n    // TETRIS\r\n    return 800;\r\n  }\r\n}\r\n\r\nexport function start() {\r\n  this.score = 0;\r\n  this.lines = 0;\r\n  this.level = 1;\r\n\r\n  this.addScore = (points) => {\r\n    this.score += points;\r\n  };\r\n\r\n  /**\r\n   * Awarn points, increase linecount and level\r\n   * @param {*} linesCleared\r\n   * @param {*} etc\r\n   */\r\n  this.awardPoints = (linesCleared, etc) => {\r\n    const points = calculatePoints(linesCleared, etc);\r\n    this.score += points;\r\n    this.lines += linesCleared;\r\n  };\r\n}\r\n\r\nfunction tryRotate(piece, grid) {\r\n  console.log(\"piece: \", piece);\r\n  const wrapX = getWrapX(grid[0].length);\r\n  let data = piece.type === \"i\" ? I_WALLKICK_DATA : OTHER_WALLKICK_DATA;\r\n  let sequence = data[`${piece.rotatedFrom}${piece.angle}`];\r\n  console.log(\"sequence: \", sequence);\r\n  for (let i = 0; i < sequence.length; i++) {\r\n    let d = sequence[i];\r\n    console.log(\"d: \", d);\r\n    let shiftedPiece = {\r\n      ...piece,\r\n      x: wrapX(piece.x - d[0]), // mirror x axis\r\n      y: piece.y - d[1],\r\n    };\r\n    if (!doesCollide(shiftedPiece, grid)) {\r\n      return shiftedPiece;\r\n    }\r\n  }\r\n}\r\n\r\nfunction getColour(piece, opts) {\r\n  const archetype = pieces[piece.type];\r\n  if (archetype) {\r\n    return archetype.colour;\r\n  } else {\r\n    return \"green\";\r\n  }\r\n}\r\n\r\nexport { tryRotate, getColour };\r\n","export const getCircleToGrid = ({\r\n  GRID_WIDTH,\r\n  GRID_HEIGHT,\r\n  VOID_RADIUS,\r\n  ACTIVE_RADIUS,\r\n}) =>\r\n  function getGridCoords(angle, radius) {\r\n    const gridX = Math.floor((angle / (2 * Math.PI)) * GRID_WIDTH);\r\n    const gridY = Math.floor(\r\n      ((radius - VOID_RADIUS) / ACTIVE_RADIUS) * GRID_HEIGHT\r\n    );\r\n    return [gridX, gridY];\r\n  };\r\n\r\nconst halfPi = Math.PI / 2;\r\n/**\r\n * Get angle from top, clockwise, positive\r\n * @param {number} x\r\n * @param {number} y\r\n */\r\nexport function getAngle(x, y) {\r\n  // reorient from top\r\n  let angle = Math.atan(y / x) + halfPi;\r\n  // flip around left-oriented angles\r\n  if (x < 0) angle += Math.PI;\r\n  return angle;\r\n}\r\n","/*!\n * Cross-Browser Split 1.1.1\n * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>\n * Available under the MIT License\n * ECMAScript compliant, uniform cross-browser split method\n */\n\n/**\n * Splits a string into an array of strings using a regex or string separator. Matches of the\n * separator are not included in the result array. However, if `separator` is a regex that contains\n * capturing groups, backreferences are spliced into the result each time `separator` is matched.\n * Fixes browser bugs compared to the native `String.prototype.split` and can be used reliably\n * cross-browser.\n * @param {String} str String to split.\n * @param {RegExp|String} separator Regex or string to use for separating the string.\n * @param {Number} [limit] Maximum number of items to include in the result array.\n * @returns {Array} Array of substrings.\n * @example\n *\n * // Basic use\n * split('a b c d', ' ');\n * // -> ['a', 'b', 'c', 'd']\n *\n * // With limit\n * split('a b c d', ' ', 2);\n * // -> ['a', 'b']\n *\n * // Backreferences in result array\n * split('..word1 word2..', /([a-z]+)(\\d+)/i);\n * // -> ['..', 'word', '1', ' ', 'word', '2', '..']\n */\nmodule.exports = (function split(undef) {\n\n  var nativeSplit = String.prototype.split,\n    compliantExecNpcg = /()??/.exec(\"\")[1] === undef,\n    // NPCG: nonparticipating capturing group\n    self;\n\n  self = function(str, separator, limit) {\n    // If `separator` is not a regex, use `nativeSplit`\n    if (Object.prototype.toString.call(separator) !== \"[object RegExp]\") {\n      return nativeSplit.call(str, separator, limit);\n    }\n    var output = [],\n      flags = (separator.ignoreCase ? \"i\" : \"\") + (separator.multiline ? \"m\" : \"\") + (separator.extended ? \"x\" : \"\") + // Proposed for ES6\n      (separator.sticky ? \"y\" : \"\"),\n      // Firefox 3+\n      lastLastIndex = 0,\n      // Make `global` and avoid `lastIndex` issues by working with a copy\n      separator = new RegExp(separator.source, flags + \"g\"),\n      separator2, match, lastIndex, lastLength;\n    str += \"\"; // Type-convert\n    if (!compliantExecNpcg) {\n      // Doesn't need flags gy, but they don't hurt\n      separator2 = new RegExp(\"^\" + separator.source + \"$(?!\\\\s)\", flags);\n    }\n    /* Values for `limit`, per the spec:\n     * If undefined: 4294967295 // Math.pow(2, 32) - 1\n     * If 0, Infinity, or NaN: 0\n     * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;\n     * If negative number: 4294967296 - Math.floor(Math.abs(limit))\n     * If other: Type-convert, then use the above rules\n     */\n    limit = limit === undef ? -1 >>> 0 : // Math.pow(2, 32) - 1\n    limit >>> 0; // ToUint32(limit)\n    while (match = separator.exec(str)) {\n      // `separator.lastIndex` is not reliable cross-browser\n      lastIndex = match.index + match[0].length;\n      if (lastIndex > lastLastIndex) {\n        output.push(str.slice(lastLastIndex, match.index));\n        // Fix browsers whose `exec` methods don't consistently return `undefined` for\n        // nonparticipating capturing groups\n        if (!compliantExecNpcg && match.length > 1) {\n          match[0].replace(separator2, function() {\n            for (var i = 1; i < arguments.length - 2; i++) {\n              if (arguments[i] === undef) {\n                match[i] = undef;\n              }\n            }\n          });\n        }\n        if (match.length > 1 && match.index < str.length) {\n          Array.prototype.push.apply(output, match.slice(1));\n        }\n        lastLength = match[0].length;\n        lastLastIndex = lastIndex;\n        if (output.length >= limit) {\n          break;\n        }\n      }\n      if (separator.lastIndex === match.index) {\n        separator.lastIndex++; // Avoid an infinite loop\n      }\n    }\n    if (lastLastIndex === str.length) {\n      if (lastLength || !separator.test(\"\")) {\n        output.push(\"\");\n      }\n    } else {\n      output.push(str.slice(lastLastIndex));\n    }\n    return output.length > limit ? output.slice(0, limit) : output;\n  };\n\n  return self;\n})();\n","\nvar indexOf = [].indexOf;\n\nmodule.exports = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};","// contains, add, remove, toggle\nvar indexof = require('indexof')\n\nmodule.exports = ClassList\n\nfunction ClassList(elem) {\n    var cl = elem.classList\n\n    if (cl) {\n        return cl\n    }\n\n    var classList = {\n        add: add\n        , remove: remove\n        , contains: contains\n        , toggle: toggle\n        , toString: $toString\n        , length: 0\n        , item: item\n    }\n\n    return classList\n\n    function add(token) {\n        var list = getTokens()\n        if (indexof(list, token) > -1) {\n            return\n        }\n        list.push(token)\n        setTokens(list)\n    }\n\n    function remove(token) {\n        var list = getTokens()\n            , index = indexof(list, token)\n\n        if (index === -1) {\n            return\n        }\n\n        list.splice(index, 1)\n        setTokens(list)\n    }\n\n    function contains(token) {\n        return indexof(getTokens(), token) > -1\n    }\n\n    function toggle(token) {\n        if (contains(token)) {\n            remove(token)\n            return false\n        } else {\n            add(token)\n            return true\n        }\n    }\n\n    function $toString() {\n        return elem.className\n    }\n\n    function item(index) {\n        var tokens = getTokens()\n        return tokens[index] || null\n    }\n\n    function getTokens() {\n        var className = elem.className\n\n        return filter(className.split(\" \"), isTruthy)\n    }\n\n    function setTokens(list) {\n        var length = list.length\n\n        elem.className = list.join(\" \")\n        classList.length = length\n\n        for (var i = 0; i < list.length; i++) {\n            classList[i] = list[i]\n        }\n\n        delete list[length]\n    }\n}\n\nfunction filter (arr, fn) {\n    var ret = []\n    for (var i = 0; i < arr.length; i++) {\n        if (fn(arr[i])) ret.push(arr[i])\n    }\n    return ret\n}\n\nfunction isTruthy(value) {\n    return !!value\n}\n","var split = require('browser-split')\nvar ClassList = require('class-list')\n\nvar w = typeof window === 'undefined' ? require('html-element') : window\nvar document = w.document\nvar Text = w.Text\n\nfunction context () {\n\n  var cleanupFuncs = []\n\n  function h() {\n    var args = [].slice.call(arguments), e = null\n    function item (l) {\n      var r\n      function parseClass (string) {\n        // Our minimal parser doesn’t understand escaping CSS special\n        // characters like `#`. Don’t use them. More reading:\n        // https://mathiasbynens.be/notes/css-escapes .\n\n        var m = split(string, /([\\.#]?[^\\s#.]+)/)\n        if(/^\\.|#/.test(m[1]))\n          e = document.createElement('div')\n        forEach(m, function (v) {\n          var s = v.substring(1,v.length)\n          if(!v) return\n          if(!e)\n            e = document.createElement(v)\n          else if (v[0] === '.')\n            ClassList(e).add(s)\n          else if (v[0] === '#')\n            e.setAttribute('id', s)\n        })\n      }\n\n      if(l == null)\n        ;\n      else if('string' === typeof l) {\n        if(!e)\n          parseClass(l)\n        else\n          e.appendChild(r = document.createTextNode(l))\n      }\n      else if('number' === typeof l\n        || 'boolean' === typeof l\n        || l instanceof Date\n        || l instanceof RegExp ) {\n          e.appendChild(r = document.createTextNode(l.toString()))\n      }\n      //there might be a better way to handle this...\n      else if (isArray(l))\n        forEach(l, item)\n      else if(isNode(l))\n        e.appendChild(r = l)\n      else if(l instanceof Text)\n        e.appendChild(r = l)\n      else if ('object' === typeof l) {\n        for (var k in l) {\n          if('function' === typeof l[k]) {\n            if(/^on\\w+/.test(k)) {\n              (function (k, l) { // capture k, l in the closure\n                if (e.addEventListener){\n                  e.addEventListener(k.substring(2), l[k], false)\n                  cleanupFuncs.push(function(){\n                    e.removeEventListener(k.substring(2), l[k], false)\n                  })\n                }else{\n                  e.attachEvent(k, l[k])\n                  cleanupFuncs.push(function(){\n                    e.detachEvent(k, l[k])\n                  })\n                }\n              })(k, l)\n            } else {\n              // observable\n              e[k] = l[k]()\n              cleanupFuncs.push(l[k](function (v) {\n                e[k] = v\n              }))\n            }\n          }\n          else if(k === 'style') {\n            if('string' === typeof l[k]) {\n              e.style.cssText = l[k]\n            }else{\n              for (var s in l[k]) (function(s, v) {\n                if('function' === typeof v) {\n                  // observable\n                  e.style.setProperty(s, v())\n                  cleanupFuncs.push(v(function (val) {\n                    e.style.setProperty(s, val)\n                  }))\n                } else\n                  var match = l[k][s].match(/(.*)\\W+!important\\W*$/);\n                  if (match) {\n                    e.style.setProperty(s, match[1], 'important')\n                  } else {\n                    e.style.setProperty(s, l[k][s])\n                  }\n              })(s, l[k][s])\n            }\n          } else if(k === 'attrs') {\n            for (var v in l[k]) {\n              e.setAttribute(v, l[k][v])\n            }\n          }\n          else if (k.substr(0, 5) === \"data-\") {\n            e.setAttribute(k, l[k])\n          } else {\n            e[k] = l[k]\n          }\n        }\n      } else if ('function' === typeof l) {\n        //assume it's an observable!\n        var v = l()\n        e.appendChild(r = isNode(v) ? v : document.createTextNode(v))\n\n        cleanupFuncs.push(l(function (v) {\n          if(isNode(v) && r.parentElement)\n            r.parentElement.replaceChild(v, r), r = v\n          else\n            r.textContent = v\n        }))\n      }\n\n      return r\n    }\n    while(args.length)\n      item(args.shift())\n\n    return e\n  }\n\n  h.cleanup = function () {\n    for (var i = 0; i < cleanupFuncs.length; i++){\n      cleanupFuncs[i]()\n    }\n    cleanupFuncs.length = 0\n  }\n\n  return h\n}\n\nvar h = module.exports = context()\nh.context = context\n\nfunction isNode (el) {\n  return el && el.nodeName && el.nodeType\n}\n\nfunction forEach (arr, fn) {\n  if (arr.forEach) return arr.forEach(fn)\n  for (var i = 0; i < arr.length; i++) fn(arr[i], i)\n}\n\nfunction isArray (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]'\n}\n\n\n","import { updateFps, renderFps } from \"./fps\";\r\nimport ModeSelector from \"./mode_selector\";\r\n// import memoize from \"lodash.memoize\";\r\nimport input from \"./input\";\r\nimport {\r\n  start,\r\n  getWrapX,\r\n  getPieceGridCoords,\r\n  doesCollide,\r\n  spawn,\r\n  getNext,\r\n  removeLines,\r\n  calculatePoints,\r\n  tryRotate,\r\n  getColour\r\n} from \"./game\";\r\nimport { getCircleToGrid, getAngle } from \"./geometry\";\r\nimport h from \"hyperscript\";\r\n\r\nconst SCREEN_WIDTH = 640;\r\nconst SCREEN_HEIGHT = 480;\r\nconst GRID_WIDTH = 32;\r\nconst GRID_HEIGHT = 14;\r\nconst VOID_RADIUS = 16;\r\nconst CRUST_THICKNESS = 16;\r\nconst SCREEN_CENTRE = [(SCREEN_WIDTH - 1) / 2, (SCREEN_HEIGHT - 1) / 2];\r\nconst ACTIVE_RADIUS = SCREEN_HEIGHT / 2 - (VOID_RADIUS + CRUST_THICKNESS);\r\n\r\nlet circleRadius = SCREEN_HEIGHT - 1 * CRUST_THICKNESS;\r\nconst circle = {\r\n  x: (SCREEN_WIDTH - circleRadius) / 2,\r\n  y: CRUST_THICKNESS,\r\n  bottom: SCREEN_HEIGHT - CRUST_THICKNESS,\r\n  w: (SCREEN_WIDTH - circleRadius) / 2 + circleRadius,\r\n};\r\nlet ctx;\r\nconst events = [];\r\n\r\nconst modeSelector = {};\r\n\r\nlet clearing = null;\r\n\r\nlet piece = null;\r\n\r\nlet mainMenu = true;\r\nlet round = null;\r\n\r\nconst wrapX = getWrapX(GRID_WIDTH);\r\n\r\nconst grid = new Array(GRID_HEIGHT).fill(null).map(() => {\r\n  return new Array(GRID_WIDTH).fill(0);\r\n});\r\nlet grid2;\r\n\r\nfunction clearGrid() {\r\n  grid.forEach((row) => {\r\n    row.fill(0);\r\n  });\r\n}\r\n\r\nfunction gridLookup(x, y) {\r\n  return grid[y] && grid[y][x];\r\n}\r\n// let lookup = memoize(gridLookup, (x, y) => `${x},${y}`);\r\n\r\nconst getGridCoords = getCircleToGrid({\r\n  GRID_WIDTH,\r\n  GRID_HEIGHT,\r\n  VOID_RADIUS,\r\n  ACTIVE_RADIUS,\r\n});\r\n\r\nfunction renderGrid(grid) {\r\n  ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n  ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\r\n  let pixelHeight = 2;\r\n\r\n  let hue = 0;\r\n  if (modeSelector.mode === \"colour\") {\r\n    hue = (dotX / GRID_WIDTH) * 360;\r\n    ctx.fillStyle = `hsla(${hue}deg, 100%, 80%, 1.0)`;\r\n  } else if (modeSelector.mode === \"nuts\") {\r\n    hue = (dotX / (GRID_WIDTH / 20)) * 360;\r\n    ctx.fillStyle = `hsla(${hue}deg, 100%, 80%, 1.0)`;\r\n  } else if (modeSelector.mode === \"vcr\") {\r\n    ctx.fillStyle = `rgb(10,250,100)`;\r\n    pixelHeight = 1;\r\n  } else {\r\n    ctx.fillStyle = `rgb(200,200,200)`;\r\n  }\r\n\r\n  const xCentre = SCREEN_CENTRE[0];\r\n  const yCentre = SCREEN_CENTRE[1];\r\n\r\n  // for each pixel\r\n  for (let y = circle.y; y < circle.bottom; y += 2) {\r\n    for (let x = circle.x; x < circle.w; x += 2) {\r\n      const dx = x - xCentre;\r\n      const dy = y - yCentre;\r\n\r\n      const radius = Math.sqrt(dx ** 2 + dy ** 2);\r\n      const angle = getAngle(dx, dy);\r\n\r\n      const [gridX, gridY] = getGridCoords(angle, radius);\r\n\r\n      let fuzz = 0;\r\n      if (modeSelector.mode === \"fuzzy\") {\r\n        fuzz = Math.random() * 3 - 1.5;\r\n      } else if (modeSelector.mode === \"nuts\") {\r\n        fuzz = Math.random() * 6 - 3;\r\n      }\r\n      if (shock) fuzz = Math.random() * shock - shock / 2;\r\n\r\n      // if (gridLookup(gridX, gridY)) {\r\n      // if (lookup(gridX, gridY)) {\r\n      if (grid[gridY] && grid[gridY][gridX]) {\r\n        const hasShape = grid[gridY][gridX].shape;\r\n        const clearingRow = grid[gridY][gridX] === 3;\r\n        if (modeSelector.mode === \"colour\" || modeSelector.mode === \"nuts\") {\r\n          let hue2 = (hue + (angle / (2 * Math.PI)) * 360) % 360;\r\n          ctx.fillStyle = `hsla(${hue2}deg, 100%, 80%, 1.0)`;\r\n        } else {\r\n          if (hasShape) {\r\n            ctx.fillStyle = getColour(grid[gridY][gridX]);\r\n          } else if (clearingRow) {\r\n            fuzz = Math.random() * 3 - 1.5;\r\n            let hue2 = (hue + (angle / (2 * Math.PI)) * 360) % 360;\r\n            ctx.fillStyle = `hsla(${hue2}deg, 100%, 80%, 1.0)`;\r\n          } else {\r\n            ctx.fillStyle = grid[gridY][gridX].colour || `rgb(200,200,200)`;\r\n          }\r\n        }\r\n        ctx.fillRect(x, y, 2 + fuzz, pixelHeight + fuzz);\r\n      }\r\n    }\r\n  }\r\n  // lookup.cache.clear();\r\n}\r\n\r\nfunction getClickHandler() {\r\n  return function handleClick(e) {\r\n    const startedAt = timestamp();\r\n    var rect = e.target.getBoundingClientRect();\r\n    var x = e.clientX - rect.left; //x position within the element.\r\n    var y = e.clientY - rect.top; //y position within the element.\r\n\r\n    var scale = SCREEN_WIDTH / rect.width;\r\n\r\n    x = x * scale;\r\n    y = y * scale;\r\n\r\n    const dx = x - SCREEN_CENTRE[0];\r\n    const dy = y - SCREEN_CENTRE[1];\r\n\r\n    const radius = Math.sqrt(dx ** 2 + dy ** 2);\r\n    const angle = getAngle(dx, dy);\r\n\r\n    const [gridX, gridY] = getGridCoords(angle, radius);\r\n    grid[gridY] && (grid[gridY][gridX] = 1);\r\n  };\r\n}\r\n\r\nfunction lockPieceIn() {\r\n  if (piece.type === \"seed\") {\r\n\r\n  }\r\n  getPieceGridCoords(piece, grid).forEach(([x, y]) => {\r\n    if (grid[y]) grid[y][x] = { colour: getColour(piece, { dim: true }) };\r\n  });\r\n  piece = null;\r\n}\r\n\r\nfunction newGame() {\r\n  round = new start();\r\n  console.log(\"round: \", round);\r\n  clearGrid();\r\n  mainMenu = false;\r\n  const menuEl = document.querySelector(\".main-menu\");\r\n  menuEl.parentElement.removeChild(menuEl);\r\n}\r\n\r\nlet shock = 0;\r\nlet shockDecay = 0.1;\r\n\r\nfunction processEvent(event) {\r\n  // console.log(event);\r\n\r\n  if (event === \"go nuts\") {\r\n    shock = 50;\r\n  } else if (event[0] === \"input\") {\r\n    if (event[1] === \"enter\") {\r\n      if (mainMenu) {\r\n        newGame();\r\n        return;\r\n      }\r\n    }\r\n    if (piece && !mainMenu) {\r\n      switch (event[1]) {\r\n        case \"left\":\r\n          if (doesCollide({ ...piece, x: wrapX(piece.x + 1) }, grid)) {\r\n            // clunk\r\n          } else {\r\n            piece.x = wrapX(piece.x + 1);\r\n          }\r\n          break;\r\n        case \"right\":\r\n          if (doesCollide({ ...piece, x: wrapX(piece.x - 1) }, grid)) {\r\n            // clonk\r\n          } else {\r\n            piece.x = wrapX(piece.x - 1);\r\n          }\r\n          break;\r\n        case \"down\":\r\n          if (doesCollide({ ...piece, y: piece.y + 1 }, grid)) {\r\n            lockPieceIn();\r\n          } else {\r\n            piece.y += 1;\r\n          }\r\n          break;\r\n        case \"rotateR\":\r\n          //piece.angle = (piece.angle + 1) % 4;\r\n          piece.rotation = 1;\r\n          break;\r\n        case \"rotateL\":\r\n          piece.rotation = -1;\r\n          // piece.angle = piece.angle - 1;\r\n          // if (piece.angle < 0) piece.angle = 3;\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  } else if (event[0] === \"clear\") {\r\n  }\r\n}\r\n\r\nlet startTime;\r\nlet dotX = 0;\r\nconst speed = 2 / 30 / 32;\r\nlet fps;\r\n// Gravity\r\nlet fallingSpeed = 0.001;\r\n\r\nfunction update(t) {\r\n  while (events.length) {\r\n    let event = events.shift();\r\n    processEvent(event);\r\n  }\r\n  fps = updateFps(t) || fps;\r\n  dotX = wrapX(dotX + speed * t);\r\n\r\n  shock = Math.max(0, shock - shockDecay * t);\r\n\r\n  grid2 = grid.map((line) => line.slice());\r\n\r\n  if (piece) {\r\n    piece.falling += t * fallingSpeed;\r\n    if (piece.falling > piece.fallNext) {\r\n      piece.fallNext++;\r\n      if (doesCollide({ ...piece, y: piece.y + 1 }, grid)) {\r\n        lockPieceIn();\r\n        return;\r\n      } else {\r\n        piece.y += 1;\r\n      }\r\n    }\r\n    if (piece.rotation && piece.type !== \"o\") {\r\n      // basic attempt\r\n      const pieceRotated = {\r\n        ...piece,\r\n        rotation: 0,\r\n        rotatedFrom: piece.angle,\r\n        angle: { \"-1\": 3, 0: 0, 1: 1, 2: 2, 3: 3, 4: 0 }[\r\n          piece.angle + piece.rotation\r\n        ],\r\n      };\r\n      const rotateAttempt = tryRotate(pieceRotated, grid);\r\n      piece = rotateAttempt || piece;\r\n      piece.rotation = 0;\r\n    }\r\n\r\n    const pieceCoords = getPieceGridCoords(piece, grid);\r\n    pieceCoords.forEach(([x, y]) => {\r\n      if (y < 0) return;\r\n      if (grid2[y]) grid2[y][x] = piece;\r\n    });\r\n  } else if (clearing) {\r\n    // animating\r\n    if (timestamp() - clearing.at >= 500) {\r\n      removeLines(clearing.lines, grid);\r\n      grid2 = grid;\r\n      clearing = null;\r\n    }\r\n  } else {\r\n    const completeLines = [];\r\n    grid2.forEach((line, y) => {\r\n      if (line.find((block) => block === 0) === undefined) {\r\n        completeLines.push(y);\r\n        grid[y].fill(3);\r\n      }\r\n    });\r\n    if (completeLines.length) {\r\n      clearing = {\r\n        lines: completeLines,\r\n        at: timestamp(),\r\n      };\r\n      const pointsAwarded = calculatePoints(completeLines.length, {\r\n        level,\r\n        lastPiece: null,\r\n      });\r\n      const level = round.level;\r\n\r\n      // check level\r\n      // check last piece to detect T-spins, room to manoeuvre\r\n      round.addScore(pointsAwarded);\r\n    } else if (!mainMenu) {\r\n      piece = spawn();\r\n      if (doesCollide(piece, grid)) {\r\n        // GAME OVER\r\n        // high score?\r\n        piece = null;\r\n        showMainMenu(\"GAME OVER\", { lastScore: round.score });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction showMainMenu(message, etc) {\r\n  mainMenu = true;\r\n  const menuScreen = h(\"div.main-menu\", [\r\n    h(\"div\", [h(\"h1\", \"Orbital\"), h(\"h2\", \"Radial Matrix\")]),\r\n    h(\"nav\", h(\"div\", \"Hit Enter/Tap to start\")),\r\n    etc && h(\"div.lastScore\", etc.lastScore),\r\n  ]);\r\n  document.querySelector(\"body\").appendChild(menuScreen);\r\n}\r\n\r\nfunction render() {\r\n  renderGrid(grid2);\r\n  // renderFps(ctx, fps);\r\n}\r\n\r\nfunction timestamp() {\r\n  return window.performance && window.performance.now\r\n    ? window.performance.now()\r\n    : Date.now();\r\n}\r\n\r\nlet last = timestamp();\r\n\r\nfunction step() {\r\n  let now = timestamp();\r\n  if (startTime === undefined) startTime = now;\r\n  const elapsed = now - startTime;\r\n  let dt = Math.min(1000, now - last);\r\n  update(dt);\r\n  render();\r\n  last = now;\r\n  window.requestAnimationFrame(step);\r\n}\r\n\r\nfunction init() {\r\n  view.setAttribute(\"width\", SCREEN_WIDTH);\r\n  view.setAttribute(\"height\", SCREEN_HEIGHT);\r\n  ctx = view.getContext(\"2d\");\r\n  // modeSelector.init();\r\n  input.init(document, events);\r\n  view.addEventListener(\"click\", getClickHandler());\r\n  document.addEventListener(\"click\", () => events.push([\"input\", \"enter\"]));\r\n\r\n  console.log(getNext());\r\n  showMainMenu();\r\n  window.requestAnimationFrame(step);\r\n}\r\n\r\ninit();\r\n"]}